<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Poemas para Lilian Cuellar ‚Äî D√≠a 30</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --rose: #ff5a7a;
            /* acento */
            --rose-2: #ffb3c1;
            /* claro */
            --ink: #1d1d1f;
            /* texto */
            --bg: #fff7f9;
            /* fondo */
            --card: #ffffff;
            /* tarjetas */
            --muted: #6b7280;
            /* gris */
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
            color: var(--ink);
            background:
                radial-gradient(90vmax 60vmax at 85% -10%, #ffd9e1 0%, transparent 60%),
                radial-gradient(80vmax 60vmax at -10% 0%, #ffe7ee 0%, transparent 55%),
                var(--bg);
        }

        header {
            text-align: center;
            padding: 3.5rem 1rem 2rem;
            position: relative;
        }

        .brand {
            font-family: "Great Vibes", cursive;
            font-size: 3rem;
            line-height: 1;
            color: var(--rose);
        }

        .tag {
            margin-top: .5rem;
            color: var(--muted)
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 1rem 4rem
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.25rem
        }

        @media (min-width:900px) {
            .grid {
                grid-template-columns: 1.4fr .8fr
            }
        }

        .card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 90, 122, .18);
            padding: 1.25rem
        }

        .card.soft {
            box-shadow: 0 8px 24px rgba(0, 0, 0, .06)
        }

        .card h2 {
            margin: .2rem 0 1rem;
            font-size: 1.25rem
        }

        .poem-title {
            font-family: "Great Vibes";
            font-size: 2.2rem;
            color: var(--rose);
            margin: .25rem 0 0
        }

        .poem-meta {
            color: var(--muted);
            font-size: .9rem;
            margin-bottom: 1rem
        }

        .poem-body {
            white-space: pre-wrap;
            line-height: 1.9;
            font-size: 1.05rem
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #ffd1db, transparent);
            margin: 1rem 0
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            padding: .5rem .8rem;
            border-radius: 999px;
            background: #fff0f4;
            color: #d83b60;
            font-weight: 600;
            font-size: .9rem
        }

        .pill svg {
            width: 18px;
            height: 18px
        }

        .countdown {
            display: flex;
            gap: .6rem;
            flex-wrap: wrap;
            margin-top: .75rem
        }

        .cd-item {
            min-width: 75px;
            text-align: center;
            background: #fff0f4;
            padding: .6rem .8rem;
            border-radius: 14px
        }

        .cd-item .num {
            font-weight: 700;
            font-size: 1.4rem
        }

        .cd-item .lbl {
            font-size: .75rem;
            color: #b22a4b
        }

        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem
        }

        .section-title h3 {
            margin: .25rem 0
        }

        .section-title .hint {
            color: var(--muted);
            font-size: .9rem
        }

        details.poem-item {
            border: 1px dashed #ffd1db;
            border-radius: 14px;
            padding: .8rem 1rem;
            background: white
        }

        details.poem-item summary {
            cursor: pointer;
            list-style: none;
        }

        details.poem-item summary::-webkit-details-marker {
            display: none
        }

        .poem-date {
            color: var(--muted);
            font-size: .85rem
        }

        .admin {
            position: sticky;
            top: 1rem
        }

        label {
            font-weight: 600;
            display: block;
            margin: .7rem 0 .35rem
        }

        input[type="text"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: .75rem .9rem;
            border-radius: 12px;
            border: 1px solid #ffd1db;
            background: white;
            font: inherit
        }

        textarea {
            min-height: 160px;
            resize: vertical
        }

        .row {
            display: grid;
            grid-template-columns: 1fr;
            gap: .8rem
        }

        @media(min-width:700px) {
            .row.two {
                grid-template-columns: 1fr 1fr
            }
        }

        .btn {
            appearance: none;
            border: none;
            background: var(--rose);
            color: white;
            padding: .75rem 1rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 18px rgba(255, 90, 122, .35)
        }

        .btn.secondary {
            background: #ffe9ef;
            color: #b22a4b;
            box-shadow: none
        }

        .btn.ghost {
            background: transparent;
            color: #b22a4b
        }

        .btn:active {
            transform: translateY(1px)
        }

        .toolbar {
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
            margin: .5rem 0 1rem
        }

        .foot {
            margin-top: 2rem;
            text-align: center;
            color: var(--muted);
            font-size: .9rem
        }

        .heart {
            display: inline-block;
            transform: translateY(2px)
        }

        .search {
            display: flex;
            gap: .5rem
        }

        .search input {
            flex: 1
        }

        .name-edit {
            display: flex;
            gap: .5rem;
            align-items: center
        }

        .name-edit input {
            max-width: 220px
        }

        .small {
            font-size: .85rem;
            color: var(--muted)
        }
    </style>
</head>

<body>
    <header>
        <div class="brand" id="brand">Poemas para Lilian Cuellar</div>
        <div class="tag">Una poes√≠a nueva cada d√≠a 30 ‚ú®</div>
    </header>

    <main class="wrap grid">
        <!-- Columna izquierda: Poes√≠a del mes + Archivo -->
        <section class="card">
            <div class="pill" title="Se revela cada d√≠a 30">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12 21s-6.5-4.35-9-8.5C1 8.5 3.5 5 7 5c2 0 3.5 1 5 3 1.5-2 3-3 5-3 3.5 0 6 3.5 4 7.5-2.5 4.15-9 8.5-9 8.5Z"
                        stroke="currentColor" stroke-width="1.5" />
                </svg>
                D√≠a 30
            </div>
            <h2>Poes√≠a del mes</h2>
            <h1 class="poem-title" id="poemTitle">A√∫n sin publicar</h1>
            <div class="poem-meta" id="poemMeta">Agrega tu primera poes√≠a y se mostrar√° aqu√≠ üíå</div>
            <div class="poem-body" id="poemBody"></div>
            <div class="divider"></div>

            <div class="section-title">
                <h3>Archivo de poes√≠as</h3>
                <div class="search">
                    <input id="q" type="text" placeholder="Buscar por t√≠tulo o texto‚Ä¶" />
                    <button class="btn secondary" id="btnBuscar">Buscar</button>
                </div>
            </div>
            <div id="archive" class="row"></div>
            <div class="toolbar">
                <button class="btn secondary" id="btnExportar">Exportar JSON</button>
                <label for="importFile" class="btn ghost" style="cursor:pointer">Importar JSON</label>
                <input id="importFile" type="file" accept="application/json" hidden />
            </div>
        </section>

        <!-- Columna derecha: Pr√≥xima fecha + Admin -->
        <aside class="card soft admin">
            <h2>Pr√≥xima publicaci√≥n</h2>
            <div id="nextDate" class="poem-meta">‚Äî</div>
            <div class="countdown" id="countdown"></div>

            <div class="divider"></div>
            <div class="section-title">
                <h3>Panel de autor ‚úçÔ∏è</h3>
            </div>

            <div class="name-edit">
                <label for="nombreElla" style="margin:0">Para:</label>
                <input type="text" id="nombreElla" placeholder="Nombre de ella" />
                <button class="btn secondary" id="btnGuardarNombre">Guardar</button>
            </div>
            <p class="small" id="saludo">El encabezado mostrar√° su nombre.</p>

            <form id="poemForm">
                <label for="title">T√≠tulo</label>
                <input type="text" id="title" placeholder="Ej. Tu risa en mi ventana" required />

                <div class="row two">
                    <div>
                        <label for="date">Fecha de publicaci√≥n</label>
                        <input type="date" id="date" required />
                    </div>
                    <div>
                        <label for="visible">Visibilidad</label>
                        <select id="visible"
                            style="width:100%; padding:.75rem .9rem; border-radius:12px; border:1px solid #ffd1db; background:white; font:inherit">
                            <option value="auto">Autom√°tica (se muestra desde su fecha)</option>
                            <option value="borrador">Borrador (no se muestra)</option>
                        </select>
                    </div>
                </div>

                <label for="body">Tu poema</label>
                <textarea id="body" placeholder="Escribe aqu√≠‚Ä¶ Usa Enter para saltos de l√≠nea." required></textarea>

                <div class="toolbar">
                    <button class="btn" type="submit">Guardar poema</button>
                    <button class="btn ghost" type="button" id="btnDemo">Cargar ejemplo</button>
                    <button class="btn ghost" type="button" id="btnBorrarTodo" title="Eliminar todos los poemas">Borrar
                        todo</button>
                </div>
            </form>

            <div class="foot">Hecho con <span class="heart">‚ù§</span> para ustedes</div>
        </aside>
    </main>

    <script>
        // ------- Utilidades de fecha --------
        const fmt = (d) => new Intl.DateTimeFormat('es-SV', { dateStyle: 'long' }).format(d);
        const today = new Date();
        function lastDayOfMonth(year, month) { // month: 0-11
            return new Date(year, month + 1, 0).getDate();
        }
        function day30OrLast(year, month) {
            return Math.min(30, lastDayOfMonth(year, month));
        }
        function nextReleaseDate(base = new Date()) {
            const y = base.getFullYear();
            const m = base.getMonth();
            const day30 = day30OrLast(y, m);
            if (base.getDate() < day30) {
                return new Date(y, m, day30, 0, 0, 0);
            }
            // siguiente mes
            const ny = m === 11 ? y + 1 : y; const nm = (m + 1) % 12;
            return new Date(ny, nm, day30OrLast(ny, nm), 0, 0, 0);
        }

        // ------- Almacenamiento local -------
        const KEY = 'poemas_v1';
        const NAME_KEY = 'poemas_nombre_ella';
        function loadPoems() {
            try { return JSON.parse(localStorage.getItem(KEY)) || [] } catch { return [] }
        }
        function savePoems(list) { localStorage.setItem(KEY, JSON.stringify(list)); }

        // ------- Renderizar cabecera / nombre -------
        const brand = document.getElementById('brand');
        const nombreEllaInput = document.getElementById('nombreElla');
        const saludo = document.getElementById('saludo');
        function loadName() {
            const n = localStorage.getItem(NAME_KEY) || '';
            if (n) { brand.textContent = `Poemas para ${n}`; nombreEllaInput.value = n; saludo.textContent = `Ahora el sitio dice: ‚ÄúPoemas para ${n}‚Äù.`; }
        }

        document.getElementById('btnGuardarNombre').addEventListener('click', () => {
            const n = nombreEllaInput.value.trim();
            localStorage.setItem(NAME_KEY, n);
            loadName();
        });

        // ------- Render Poes√≠a del mes -------
        const poemTitle = document.getElementById('poemTitle');
        const poemMeta = document.getElementById('poemMeta');
        const poemBody = document.getElementById('poemBody');

        function visiblePoems(list) {
            const now = new Date();
            return list.filter(p => p.visible !== "borrador" && new Date(p.date) <= now)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function renderCurrentPoem() {
            const list = loadPoems();
            const visibles = visiblePoems(list);
            if (!visibles.length) {
                poemTitle.textContent = 'A√∫n sin publicar';
                poemMeta.textContent = 'Agrega tu primera poes√≠a y se mostrar√° aqu√≠ üíå';
                poemBody.textContent = '';
                return;
            }
            // √∫ltima visible (la m√°s reciente)
            const p = visibles[0];
            poemTitle.textContent = p.title || 'Sin t√≠tulo';
            poemMeta.textContent = `Publicada el ${fmt(new Date(p.date))}`;
            poemBody.textContent = p.body;
        }

        // ------- Archivo & b√∫squeda -------
        const archive = document.getElementById('archive');
        function renderArchive(filter = '') {
            const list = loadPoems().sort((a, b) => new Date(b.date) - new Date(a.date));
            const q = filter.trim().toLowerCase();
            const filtered = q ? list.filter(p => `${p.title} ${p.body}`.toLowerCase().includes(q)) : list;

            archive.innerHTML = '';
            if (!filtered.length) {
                archive.innerHTML = '<p class="small">No hay poemas por ahora.</p>';
                return;
            }

            filtered.forEach((p, idx) => {
                const el = document.createElement('details');
                el.className = 'poem-item';
                el.innerHTML = `
          <summary><strong>${p.title || 'Sin t√≠tulo'}</strong> <span class="poem-date">‚Äî ${fmt(new Date(p.date))}${p.visible === 'borrador' ? ' ¬∑ borrador' : ''}</span></summary>
          <div class="divider" style="margin:.6rem 0"></div>
          <div class="poem-body">${escapeHtml(p.body).replace(/\n/g, '<br>')}</div>
          <div class="toolbar" style="margin-top:.8rem">
            <button class="btn secondary" data-edit="${idx}">Editar</button>
            <button class="btn ghost" data-del="${idx}">Eliminar</button>
          </div>
        `;
                archive.appendChild(el);
            });

            // acciones editar/eliminar
            archive.querySelectorAll('[data-del]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const idx = +btn.dataset.del;
                    const list = loadPoems();
                    if (confirm('¬øEliminar este poema?')) {
                        list.splice(idx, 1); savePoems(list); renderAll();
                    }
                })
            })
            archive.querySelectorAll('[data-edit]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const idx = +btn.dataset.edit;
                    const list = loadPoems();
                    const p = list[idx];
                    title.value = p.title; date.value = p.date; body.value = p.body; visible.value = p.visible || 'auto';
                    // sacar el elemento para re-guardar sobre √©l (simple UX)
                    list.splice(idx, 1); savePoems(list); renderAll();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                })
            })
        }

        function escapeHtml(str) {
            return str.replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#039;" }[m]));
        }

        // ------- Exportar / Importar -------
        document.getElementById('btnExportar').addEventListener('click', () => {
            const data = { nombre: localStorage.getItem(NAME_KEY) || '', poemas: loadPoems() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'poemas.json';
            a.click();
            URL.revokeObjectURL(a.href);
        });

        document.getElementById('importFile').addEventListener('change', (ev) => {
            const file = ev.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const obj = JSON.parse(reader.result);
                    if (obj.nombre !== undefined) localStorage.setItem(NAME_KEY, obj.nombre);
                    if (Array.isArray(obj.poemas)) savePoems(obj.poemas);
                    loadName(); renderAll();
                    alert('Importaci√≥n realizada.');
                } catch (e) { alert('Archivo inv√°lido'); }
            };
            reader.readAsText(file);
        });

        // ------- B√∫squeda -------
        document.getElementById('btnBuscar').addEventListener('click', () => {
            renderArchive(document.getElementById('q').value)
        });
        document.getElementById('q').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { e.preventDefault(); renderArchive(e.target.value); }
        });

        // ------- Formulario -------
        const form = document.getElementById('poemForm');
        const title = document.getElementById('title');
        const date = document.getElementById('date');
        const body = document.getElementById('body');
        const visible = document.getElementById('visible');

        function setDefaultDate() {
            const d = nextReleaseDate(new Date());
            date.value = d.toISOString().slice(0, 10);
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const entry = {
                title: title.value.trim() || 'Sin t√≠tulo',
                date: date.value,
                body: body.value.trim(),
                visible: visible.value
            };
            const list = loadPoems();
            list.push(entry); savePoems(list);
            title.value = ''; body.value = '';
            setDefaultDate();
            alert('Poema guardado');
            renderAll();
        });

        document.getElementById('btnDemo').addEventListener('click', () => {
            title.value = 'Treinta latidos';
            body.value = `Treinta latidos hacen un mes\n\ny a√∫n as√≠, cuando te miro,\nel reloj decide quedarse.\n\nPorque el tiempo, amor,\naprende tus manos\ny corre s√≥lo para volver a ti.`;
        });

        document.getElementById('btnBorrarTodo').addEventListener('click', () => {
            if (confirm('¬øEliminar TODOS los poemas? Esta acci√≥n no se puede deshacer.')) {
                savePoems([]); renderAll();
            }
        })

        // ------- Pr√≥xima fecha + countdown -------
        const nextDateEl = document.getElementById('nextDate');
        const countdownEl = document.getElementById('countdown');
        function renderNextDate() {
            const d = nextReleaseDate(new Date());
            nextDateEl.textContent = fmt(d);
            function tick() {
                const now = new Date();
                const diff = Math.max(0, d - now);
                const s = Math.floor(diff / 1000);
                const days = Math.floor(s / 86400);
                const hrs = Math.floor((s % 86400) / 3600);
                const min = Math.floor((s % 3600) / 60);
                const sec = s % 60;
                countdownEl.innerHTML = `
          <div class="cd-item"><div class="num">${days}</div><div class="lbl">d√≠as</div></div>
          <div class="cd-item"><div class="num">${hrs}</div><div class="lbl">horas</div></div>
          <div class="cd-item"><div class="num">${min}</div><div class="lbl">min</div></div>
          <div class="cd-item"><div class="num">${sec}</div><div class="lbl">seg</div></div>`;
            }
            tick();
            clearInterval(window.__cdInt); window.__cdInt = setInterval(tick, 1000);
        }

        // ------- Render general -------
        function renderAll() {
            loadName();
            renderCurrentPoem();
            renderArchive(document.getElementById('q').value || '');
            renderNextDate();
        }

        // Inicializar
        setDefaultDate();
        renderAll();
    </script>
</body>

</html>